<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurateur César Bazaar (Alpha)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="app-container">
        <!-- Vue Gallery -->
        <div id="view-gallery" class="view">
            <header>
                <h1>Collections</h1>
            </header>
            <main class="gallery-main">
                <div id="gallery-grid" class="gallery-grid">
                    <!-- Les cartes seront générées dynamiquement -->
                </div>
            </main>
        </div>

        <!-- Vue Workspace -->
        <div id="view-workspace" class="view" style="display: none;">
            <div class="workspace-header-wrap" id="workspace-header-wrap">
                <header class="workspace-header" id="workspace-header">
                    <button id="btn-back" class="back-button">← Retour</button>
                    <a id="collection-link" class="collection-link" href="#" target="_blank" rel="noopener">...</a>
                    <div class="header-actions">
                        <div class="header-menu-wrap">
                            <button type="button" id="btn-header-menu" class="header-menu-trigger" aria-label="Menu" aria-expanded="false" aria-haspopup="true">⋯</button>
                            <div id="header-menu-dropdown" class="header-menu-dropdown" role="menu" aria-hidden="true">
                                <button type="button" id="btn-save" class="secondary" role="menuitem">Sauvegarder</button>
                                <button type="button" id="btn-share" class="secondary" role="menuitem" title="Partager l'image">Partager</button>
                                <button type="button" id="btn-export-pdf" class="secondary" role="menuitem" title="Télécharger un PDF avec la config et les vues">Télécharger le PDF</button>
                                <button type="button" id="btn-export-svg" class="secondary" role="menuitem" title="Télécharger le plan en SVG vectoriel pour logiciels 3D">Télécharger le SVG</button>
                                <button type="button" id="btn-cart" class="primary" role="menuitem">Ajouter au panier (min 3)</button>
                            </div>
                        </div>
                    </div>
                </header>
                <div id="header-scroll-hint" class="header-scroll-hint" aria-hidden="true">↑ Retrouver le menu</div>
            </div>

            <main class="workspace-main" id="workspace-main">
                <div class="workspace workspace-preview-first" id="workspace">
                    <div id="molding-warning-banner" class="molding-warning-banner" aria-live="polite" style="display: none;"></div>
                    <div class="preview-controls">
                        <div class="active-colors-row-wrap">
                            <div class="active-colors-row" id="active-colors-row" aria-label="Couleurs des zones du motif"></div>
                            <button type="button" id="btn-reset-collection" class="reset-button reset-button-icon" title="Réinitialiser les couleurs (défaut SVG)" aria-label="Réinitialiser les couleurs de la collection">↺</button>
                            <button type="button" id="btn-options-drawer" class="options-drawer-trigger" aria-label="Options">Options</button>
                        </div>
                        <div class="preview-controls-extras" id="preview-controls-extras">
                            <div class="layout-selector" id="layout-selector" aria-label="Disposition du calepinage"></div>
                            <div class="calepinage-zoom-wrap" id="calepinage-zoom-wrap" aria-label="Zoom de la grille">
                                <button type="button" class="calepinage-zoom-in" title="Zoom avant (moins de carreaux)">−</button>
                                <span class="calepinage-zoom-label">5×5</span>
                                <button type="button" class="calepinage-zoom-out" title="Zoom arrière (plus de carreaux)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="preview-area" id="preview-area">
                        <div class="carousel" id="preview-carousel" role="region" aria-label="Aperçu du calepinage">
                            <button type="button" class="carousel-btn carousel-btn-prev" id="carousel-prev" aria-label="Vue précédente">&#8249;</button>
                            <div class="carousel-track-container">
                                <div class="carousel-track" id="carousel-track">
                                    <div class="carousel-slide carousel-slide-active" data-slide-index="0">
                                        <img class="visuel-watermark visuel-watermark-grid" src="assets/logo-cesar-bazaar-alpha.png" alt="" aria-hidden="true" />
                                        <div id="grid-container" class="grid-5x5"></div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="carousel-btn carousel-btn-next" id="carousel-next" aria-label="Vue suivante">&#8250;</button>
                            <div class="carousel-dots" id="carousel-dots" role="tablist" aria-label="Vues du carrousel"></div>
                        </div>
                    </div>
                </div>
            
                <!-- Sidebar desktop : nuancier à droite. Visible uniquement quand une zone est sélectionnée. Mobile : masqué, palette dans le bottom sheet -->
                <aside class="sidebar sidebar-palette-desktop" id="sidebar-palette-desktop" aria-hidden="false">
                    <h3>Nuancier</h3>
                    <p class="sidebar-no-zone-msg" id="sidebar-no-zone-msg">Cliquez sur une zone ou une pastille pour choisir une couleur.</p>
                    <div id="color-palette" class="palette-grid"></div>
                    <div class="sidebar-recap" id="sidebar-recap">
                        <h4>Récapitulatif</h4>
                        <div id="sidebar-recap-list"></div>
                    </div>
                </aside>
            </main>

            <!-- Overlay transparent : clic en dehors ferme le tiroir (sans griser l’écran) -->
            <div id="palette-drawer-overlay" class="palette-drawer-overlay" aria-hidden="true"></div>
            <!-- Tiroir minimaliste : uniquement les couleurs -->
            <div id="palette-drawer" class="palette-drawer" aria-hidden="true">
                <div class="palette-drawer-body">
                    <div id="color-palette-drawer" class="palette-grid"></div>
                </div>
            </div>

            <!-- Tiroir mobile : options grille + zoom -->
            <div id="options-drawer-overlay" class="options-drawer-overlay" aria-hidden="true"></div>
            <div id="options-drawer" class="options-drawer" aria-hidden="true">
                <div class="options-drawer-inner">
                    <h3 class="options-drawer-title">Options</h3>
                    <div class="options-drawer-layout" id="options-drawer-layout"></div>
                    <div class="options-drawer-zoom" id="options-drawer-zoom">
                        <label for="options-zoom-slider">Nombre de carreaux</label>
                        <input type="range" id="options-zoom-slider" min="2" max="20" value="5" aria-label="Zoom grille" />
                    </div>
                    <div class="options-drawer-joints">
                        <label class="options-drawer-checkbox">
                            <input type="checkbox" id="options-show-joints" aria-label="Afficher les joints" />
                            <span>Afficher les joints</span>
                        </label>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Overlay de chargement au clic sur une collection -->
    <div id="collection-loading-overlay" class="collection-loading-overlay" aria-hidden="true" aria-live="polite">
        <div class="collection-loading-content">
            <div class="collection-loading-spinner" aria-hidden="true"></div>
            <p class="collection-loading-text">Chargement de la collection…</p>
        </div>
    </div>

    <!-- Overlay génération PDF -->
    <div id="pdf-loading-overlay" class="collection-loading-overlay pdf-loading-overlay" aria-hidden="true" aria-live="polite" style="display: none;">
        <div class="collection-loading-content">
            <div class="collection-loading-spinner" aria-hidden="true"></div>
            <p class="collection-loading-text">Génération du PDF…</p>
            <p class="collection-loading-subtext">Veuillez patienter, cela peut prendre quelques secondes.</p>
        </div>
    </div>

    <!-- Overlay génération image (partage) -->
    <div id="share-image-loading-overlay" class="collection-loading-overlay share-image-loading-overlay" aria-hidden="true" aria-live="polite" style="display: none;">
        <div class="collection-loading-content">
            <div class="collection-loading-spinner" aria-hidden="true"></div>
            <p class="collection-loading-text">Génération de l'image, veuillez patienter.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    <script src="script.js"></script>
</body>
</html>